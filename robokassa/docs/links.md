# Создание ссылки оплаты

Библиотека поддерживает разные способы создания ссылки на оплату:


## [Скрипт оплаты](https://docs.robokassa.ru/script-pay/)

Этот метод "собирает" указанные параметры в единую ссылку. В результате чего получается достаточно длинная ссылка с перечисленными параметрами. Важно помнить, что предельно допустимая длина url строки составляет 2000 символов. Поэтому если вы передаёте огромное количество параметров, включая фискализацию, то рекомендуется использовать POST запросы, в которых все параметры будут находиться в теле запроса, а не URL.

```py
robokassa.generate_open_payment_link(out_sum=1000, inv_id=0)
```


## [cURL](https://web.archive.org/web/20240804061720/https://docs.robokassa.ru/pay-interface/#curl)

Способ создания ссылки через cURL прекращает своё существование, поэтому он был удалён из библиотеки. По этой причине этот метод описан не будет.

!!! warning

    Кроме того, уже сейчас для этого метода не работают следующие параметры:
    
    * `ExpirationDate`
    * `IncCurrLabel`
    * `PaymentMethods`
    * `ResultUrl2`
    * `SuccessUrl2`, `SuccessUrl2Method` соответственно
    * `FailUrl2`, `FailUrl2Method` соответственно


## [JWT](https://docs.robokassa.ru/pay-interface/#jwt)

Метод создания ссылки через JWT является самым надёжным. В данном случае параметры указываются заранее в теле токена (payload) и в ссылке они уже не будут видны. Стоит отметить, что количество параметров для этого способа невелико, по сравнению с первым.

Также, используя именно этот метод для создания ссылки, мы получаем возможность контролировать состояние ссылки. Мы можем ограничить число использований, для этого и нужен `InvoiceType`, можем деактивировать ссылку, используя метод `deactivate_invoice()` (см. раздел "Деактивация счёта/ссылки").

Метод использует асинхронный запрос к серверам Robokassa для получения ссылки, что потенциально будет медленнее, чем использование первого метода.

```python
from robokassa.types import InvoiceType

my_link = await robokassa.generate_protected_payment_link(
    invoice_type=InvoiceType.REUSABLE, inv_id=233, out_sum=1000
)
```


## [Параметры для создания](https://docs.robokassa.ru/script-parameters/)


| Наименование  | Описание |
|:----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `out_sum` | Сумма (буквально — стоимость заказа, сделанного клиентом)  <br><br> **Тип:** `Union[float, int]`  <br> **Обязательный:** ✅ |
| `inv_id` | Номер счёта в магазине. Рекомендуется использовать, если требуется работа с операциями. Может принимать значения от 1 до 2147483647 (2³¹ - 1). Значение по умолчанию — 0  <br><br> **Тип:** `int`  <br> **Обязательный:** ❌ |
| `description` | Описание, отображающееся в интерфейсе Robokassa на платежной странице, используются только символы английского или русского алфавита, цифры и знаки препинания. Максимальная длина — 100 символов  <br><br> **Тип:** `str`  <br> **Обязательный:** ❌ |
| `payment_methods` | Список из доступных методов оплаты  <br><br> **Тип:** `List[PaymentMethod]`  <br> **Обязательный:** ❌ |
| `culture` | Язык страницы оплаты Robokassa  <br><br> **Тип:** `Culture`  <br> **Обязательный:** ❌ |
| `email` | Email пользователя, который будет автоматически использован в платёжной странице <br><br> **Тип:** `str`  <br> **Обязательный:** ❌ |
| `expiration_date` | Срок действия счёта, по истечении которого доступ к странице оплаты будет остановлен  <br><br> **Тип:** `datetime`  <br> **Обязательный:** ❌ |
| `user_ip` | IP конечного пользователя, для которого будет предоставлена ссылка оплаты. Является хорошим способом противодействия злоумышленникам, чтобы ограничить доступ к оплате посторонним  <br><br> **Тип:** `str`  <br> **Обязательный:** ❌ |
| `recurring` | Если `True`, то подразумевается, что выставление данного счета будет повторяющимся (для рекуррентных платежей требуется предварительное согласование)  <br><br> **Тип:** `bool`  <br> **Обязательный:** ❌ |
| `result_url` | В оф. документации Robokassa — `ResultUrl2`<br>URL адрес, на который приходит подтверждение оплаты в формате JWS  <br><br> **Тип:** `str`  <br> **Обязательный:** ❌ |
| `success_url` | В документации Robokassa — `SuccessUrl2`<br>URL адрес, на который перенаправляется пользователь в случае успешной оплаты  <br><br> **Тип:** `str`  <br> **Обязательный:** ❌ |
| `success_url_method` | В оф. документации Robokassa — `SuccessUrl2Method`<br>Метод переадресации пользователя с данными в случае успешной оплаты  <br><br> **Тип:** `HTTPMethod`  <br> **Обязательный:** ❌ |
| `fail_url` | В оф. документации Robokassa — `FailUrl2`<br>URL адрес, на который перенаправляется пользователь в случае неудачной оплаты  <br><br> **Тип:** `str`  <br> **Обязательный:** ❌ |
| `fail_url_method` | В оф. документации Robokassa — `FailUrl2Method`<br>Метод переадресации пользователя с данными в случае неудачной оплаты  <br><br> **Тип:** `HTTPMethod`  <br> **Обязательный:** ❌ |
| `receipt` | Номенклатура, поля которой подробно описаны в разделе про [фискализацию](https://docs.robokassa.ru/fiscalization/) в официальной документации <br><br> **Тип:** `Dict[str, Any]`  <br> **Обязательный:** ❌ |

*[datetime]: datetime.datetime
*[List]: typing.List
*[Union]: typing.Union
*[PaymentMethod]: robokassa.types.PaymentMethod
*[HTTPMethod]: robokassa.types.HTTPMethod
*[Culture]: robokassa.types.Culture
*[Any]: typing.Any
*[Dict]: typing.Dict
